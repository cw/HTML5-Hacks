var console=console||{log:function(){},warn:function(){}},fabric=fabric||{version:0.1};if(!this.JSON)this.JSON={};
(function(){function k(h){return h<10?"0"+h:h}function p(h){g.lastIndex=0;return g.test(h)?'"'+h.replace(g,function(o){var q=a[o];return typeof q==="string"?q:"\\u"+("0000"+o.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+h+'"'}function e(h,o){var q,r,u,x,t=d,v,w=o[h];if(w&&typeof w==="object"&&typeof w.toJSON==="function")w=w.toJSON(h);if(typeof c==="function")w=c.call(o,h,w);switch(typeof w){case "string":return p(w);case "number":return isFinite(w)?String(w):"null";case "boolean":case "null":return String(w);
case "object":if(!w)return"null";d+=b;v=[];if(Object.prototype.toString.apply(w)==="[object Array]"){x=w.length;for(q=0;q<x;q+=1)v[q]=e(q,w)||"null";u=v.length===0?"[]":d?"[\n"+d+v.join(",\n"+d)+"\n"+t+"]":"["+v.join(",")+"]";d=t;return u}if(c&&typeof c==="object"){x=c.length;for(q=0;q<x;q+=1){r=c[q];if(typeof r==="string")if(u=e(r,w))v.push(p(r)+(d?": ":":")+u)}}else for(r in w)if(Object.hasOwnProperty.call(w,r))if(u=e(r,w))v.push(p(r)+(d?": ":":")+u);u=v.length===0?"{}":d?"{\n"+d+v.join(",\n"+d)+
"\n"+t+"}":"{"+v.join(",")+"}";d=t;return u}}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+k(this.getUTCMonth()+1)+"-"+k(this.getUTCDate())+"T"+k(this.getUTCHours())+":"+k(this.getUTCMinutes())+":"+k(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()}}var l=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
g=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,d,b,a={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},c;if(typeof JSON.stringify!=="function")JSON.stringify=function(h,o,q){var r;b=d="";if(typeof q==="number")for(r=0;r<q;r+=1)b+=" ";else if(typeof q==="string")b=q;if((c=o)&&typeof o!=="function"&&(typeof o!=="object"||typeof o.length!=="number"))throw Error("JSON.stringify");return e("",
{"":h})};if(typeof JSON.parse!=="function")JSON.parse=function(h,o){function q(u,x){var t,v,w=u[x];if(w&&typeof w==="object")for(t in w)if(Object.hasOwnProperty.call(w,t)){v=q(w,t);if(v!==undefined)w[t]=v;else delete w[t]}return o.call(u,x,w)}var r;h=String(h);l.lastIndex=0;if(l.test(h))h=h.replace(l,function(u){return"\\u"+("0000"+u.charCodeAt(0).toString(16)).slice(-4)});if(/^[\],:{}\s]*$/.test(h.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){r=eval("("+h+")");return typeof o==="function"?q({"":r},""):r}throw new SyntaxError("JSON.parse");}})();
(function(){function k(g,d){for(var b in d)g[b]=d[b];return g}function p(g,d){var b=document.createElement(g);for(var a in d)if(a==="class")b.className=d[a];else if(a==="for")b.htmlFor=d[a];else b.setAttribute(a,d[a]);return b}var e=this.fabric||(this.fabric={}),l=Array.prototype.slice;e.util={};(function(){var g=Math.PI/180;e.util.removeFromArray=function(d,b){var a=d.indexOf(b);a!==-1&&d.splice(a,1);return d};e.util.degreesToRadians=function(d){return d*g};e.util.toFixed=function(d,b){return parseFloat(Number(d).toFixed(b))};
e.util.getRandomInt=function(d,b){return Math.floor(Math.random()*(b-d+1))+d};e.util.falseFunction=function(){return false}})();if(!Array.prototype.indexOf)Array.prototype.indexOf=function(g,d){var b=this.length>>>0;d=Number(d)||0;d=Math[d<0?"ceil":"floor"](d);if(d<0)d+=b;for(;d<b;d++)if(d in this&&this[d]===g)return d;return-1};if(!Array.prototype.forEach)Array.prototype.forEach=function(g,d){for(var b=0,a=this.length>>>0;b<a;b++)b in this&&g.call(d,this[b],b,this)};if(!Array.prototype.map)Array.prototype.map=
function(g,d){for(var b=[],a=0,c=this.length>>>0;a<c;a++)if(a in this)b[a]=g.call(d,this[a],a,this);return b};if(!Array.prototype.every)Array.prototype.every=function(g,d){for(var b=0,a=this.length>>>0;b<a;b++)if(b in this&&!g.call(d,this[b],b,this))return false;return true};if(!Array.prototype.some)Array.prototype.some=function(g,d){for(var b=0,a=this.length>>>0;b<a;b++)if(b in this&&g.call(d,this[b],b,this))return true;return false};if(!Array.prototype.filter)Array.prototype.filter=function(g,d){for(var b=
[],a,c=0,h=this.length>>>0;c<h;c++)if(c in this){a=this[c];g.call(d,a,c,this)&&b.push(a)}return b};if(!Array.prototype.reduce)Array.prototype.reduce=function(g){var d=this.length>>>0,b=0,a;if(arguments.length>1)a=arguments[1];else{do{if(b in this){a=this[b++];break}if(++b>=d)throw new TypeError;}while(1)}for(;b<d;b++)if(b in this)a=g.call(null,a,this[b],b,this);return a};e.util.array={invoke:function(g,d){for(var b=l.call(arguments,2),a=[],c=0,h=g.length;c<h;c++)a[c]=b.length?g[c][d].apply(g[c],b):
g[c][d].call(g[c]);return a},min:function(g,d){var b=g.length-1,a=d?g[b][d]:g[b];if(d)for(;b--;){if(g[b][d]<a)a=g[b][d]}else for(;b--;)if(g[b]<a)a=g[b];return a},max:function(g,d){var b=g.length-1,a=d?g[b][d]:g[b];if(d)for(;b--;){if(g[b][d]>=a)a=g[b][d]}else for(;b--;)if(g[b]>=a)a=g[b];return a}};e.util.object={extend:k,clone:function(g){return k({},g)}};if(!String.prototype.trim)String.prototype.trim=function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")};e.util.string={camelize:function(g){return g.replace(/-+(.)?/g,
function(d,b){return b?b.toUpperCase():""})},capitalize:function(g){return g.charAt(0).toUpperCase()+g.slice(1).toLowerCase()}};if(!Function.prototype.bind)Function.prototype.bind=function(g){var d=this,b=l.call(arguments,1);return b.length?function(){return d.apply(g,b.concat(l.call(arguments)))}:function(){return d.apply(g,arguments)}};(function(){function g(){}var d;d=function(){for(var b in{toString:1})if(b==="toString")return false;return true}()?function(b,a){if(a.toString!==Object.prototype.toString)b.prototype.toString=
a.toString;if(a.valueOf!==Object.prototype.valueOf)b.prototype.valueOf=a.valueOf;for(var c in a)b.prototype[c]=a[c]}:function(b,a){for(var c in a)b.prototype[c]=a[c]};e.util.createClass=function(){function b(){this.initialize.apply(this,arguments)}var a=null,c=l.call(arguments,0);if(typeof c[0]==="function")a=c.shift();b.superclass=a;b.subclasses=[];if(a){g.prototype=a.prototype;b.prototype=new g;a.subclasses.push(b)}a=0;for(var h=c.length;a<h;a++)d(b,c[a]);if(!b.prototype.initialize)b.prototype.initialize=
emptyFunction;return b.prototype.constructor=b}})();(function(){function g(t){var v=Array.prototype.slice.call(arguments,1),w,A,D=v.length;for(A=0;A<D;A++){w=typeof t[v[A]];if(!/^(?:function|object|unknown)$/.test(w))return false}return true}function d(t,v){return function(w){v.call(c(t),w||window.event)}}function b(t,v){return function(w){if(u[t]&&u[t][v])for(var A=u[t][v],D=0,G=A.length;D<G;D++)A[D].call(this,w||window.event)}}var a=function(){if(typeof document.documentElement.uniqueID!=="undefined")return function(v){return v.uniqueID};
var t=0;return function(v){return v.__uniqueID||(v.__uniqueID="uniqueID__"+t++)}}(),c,h;(function(){var t={};c=function(v){return t[v]};h=function(v,w){t[v]=w}})();var o=g(document.documentElement,"addEventListener","removeEventListener")&&g(window,"addEventListener","removeEventListener"),q=g(document.documentElement,"attachEvent","detachEvent")&&g(window,"attachEvent","detachEvent"),r={},u={};if(o){addListener=function(t,v,w){t.addEventListener(v,w,false)};removeListener=function(t,v,w){t.removeEventListener(v,
w,false)}}else if(q){addListener=function(t,v,w){var A=a(t);h(A,t);r[A]||(r[A]={});r[A][v]||(r[A][v]=[]);w={handler:w,wrappedHandler:d(A,w)};r[A][v].push(w);t.attachEvent("on"+v,w.wrappedHandler)};removeListener=function(t,v,w){var A=a(t),D;if(r[A]&&r[A][v])for(var G=0,f=r[A][v].length;G<f;G++)if((D=r[A][v][G])&&D.handler===w){t.detachEvent("on"+v,D.wrappedHandler);r[A][v][G]=null}}}else{addListener=function(t,v,w){var A=a(t);u[A]||(u[A]={});if(!u[A][v]){u[A][v]=[];var D=t["on"+v];D&&u[A][v].push(D);
t["on"+v]=b(A,v)}u[A][v].push(w)};removeListener=function(t,v,w){t=a(t);if(u[t]&&u[t][v]){v=u[t][v];t=0;for(var A=v.length;t<A;t++)v[t]===w&&v.splice(t,1)}}}e.util.addListener=addListener;e.util.removeListener=removeListener;var x={};e.util.observeEvent=function(t,v){x[t]||(x[t]=[]);x[t].push(v)};e.util.fireEvent=function(t,v){var w=x[t];if(w)for(var A=0,D=w.length;A<D;A++)w[A]({memo:v})};e.util.getPointer=function(t){var v=document.documentElement,w=document.body||{scrollLeft:0},A=document.documentElement,
D=document.body||{scrollTop:0};return{x:t.pageX||(typeof t.clientX!="unknown"?t.clientX:0)+(v.scrollLeft||w.scrollLeft)-(v.clientLeft||0),y:t.pageY||(typeof t.clientY!="unknown"?t.clientY:0)+(A.scrollTop||D.scrollTop)-(A.clientTop||0)}}})(this);(function(){var g=document.createElement("div"),d=typeof g.style.filter==="string",b=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,a=function(c){return c};if(typeof g.style.opacity==="string")a=function(c,h){c.style.opacity=h;return c};else if(d)a=function(c,h){var o=
c.style;if(c.currentStyle&&!c.currentStyle.hasLayout)o.zoom=1;if(b.test(o.filter)){h=h>=0.9999?"":"alpha(opacity="+h*100+")";o.filter=o.filter.replace(b,h)}else o.filter+=" alpha(opacity="+h*100+")";return c};e.util.setStyle=function(c,h){var o=c.style;if(typeof h==="string"){c.style.cssText+=";"+h;return h.indexOf("opacity")>-1?a(c,h.match(/opacity:\s*(\d?\.?\d*)/)[1]):c}for(var q in h)if(q==="opacity")a(c,h[q]);else o[q==="float"||q==="cssFloat"?typeof o.styleFloat==="undefined"?"cssFloat":"styleFloat":
q]=h[q];return c}})();(function(){var g=document.documentElement.style,d="userSelect"in g?"userSelect":"MozUserSelect"in g?"MozUserSelect":"WebkitUserSelect"in g?"WebkitUserSelect":"KhtmlUserSelect"in g?"KhtmlUserSelect":"";e.util.makeElementUnselectable=function(b){if(typeof b.onselectstart!=="undefined")b.onselectstart=e.util.falseFunction;if(d)b.style[d]="none";else if(typeof b.unselectable=="string")b.unselectable="on";return b}})();(function(){function g(b,a){d.load(b);a()}e.util.getScript=function(b,
a){var c=document.getElementsByTagName("head")[0],h=document.createElement("script"),o=true;h.type="text/javascript";h.setAttribute("runat","server");h.onload=h.onreadystatechange=function(q){if(o)if(!(typeof this.readyState=="string"&&this.readyState!=="loaded"&&this.readyState!=="complete")){o=false;a(q||window.event);h=h.onload=h.onreadystatechange=null}};h.src=b;c.appendChild(h)};var d=this.Jaxer;if(d&&d.load)e.util.getScript=g})();e.util.getById=function(g){return typeof g==="string"?document.getElementById(g):
g};e.util.toArray=function(g){for(var d=[],b=g.length;b--;)d[b]=g[b];return d};e.util.makeElement=p;e.util.addClass=function(g,d){if((" "+g.className+" ").indexOf(" "+d+" ")===-1)g.className+=(g.className?" ":"")+d};e.util.wrapElement=function(g,d,b){if(typeof d==="string")d=p(d,b);g.parentNode&&g.parentNode.replaceChild(d,g);d.appendChild(g);return d};e.util.getElementOffset=function(g){var d=0,b=0;do{d+=g.offsetTop||0;b+=g.offsetLeft||0;g=g.offsetParent}while(g);return{left:b,top:d}};e.util.animate=
function(g){g||(g={});var d=+new Date,b=g.duration||500,a=d+b,c,h,o=g.onChange||function(){},q=g.easing||function(v){return-Math.cos(v*Math.PI)/2+0.5},r="startValue"in g?g.startValue:0,u="endValue"in g?g.endValue:100,x=r>u;g.onStart&&g.onStart();var t=setInterval(function(){c=+new Date;h=c>a?1:(c-d)/b;o(x?r-(r-u)*q(h):r+(u-r)*q(h));if(c>a){clearInterval(t);g.onComplete&&g.onComplete()}},10)};(function(){function g(){}var d=function(){for(var b=[function(){return new ActiveXObject("Microsoft.XMLHTTP")},
function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP.3.0")},function(){return new XMLHttpRequest}],a=b.length;a--;)try{if(b[a]())return b[a]}catch(c){}}();e.util.request=function(b,a){a||(a={});var c=a.method?a.method.toUpperCase():"GET",h=a.onComplete||function(){},o=d(),q;o.onreadystatechange=function(){if(o.readyState===4){h(o);o.onreadystatechange=g}};if(c==="GET"){q=null;if(typeof a.parameters=="string")b=b+(/\?/.test(b)?"&":"?")+a.parameters}o.open(c,
b,true);if(c==="POST"||c==="PUT")o.setRequestHeader("Content-Type","application/x-www-form-urlencoded");o.send(q);return o}})()})(this);
(function(){var k=this.fabric||(this.fabric={}),p=k.util.object.extend,e=k.util.string.capitalize,l=k.util.object.clone,g={cx:"left",x:"left",cy:"top",y:"top",r:"radius","fill-opacity":"opacity","fill-rule":"fillRule","stroke-width":"strokeWidth",transform:"transformMatrix"};k.parseTransformAttribute=function(){function d(q,r){var u=r[0];q[0]=Math.cos(u);q[1]=Math.sin(u);q[2]=-Math.sin(u);q[3]=Math.cos(u)}function b(q,r){var u=r.length===2?r[1]:r[0];q[0]=r[0];q[3]=u}function a(q,r){q[4]=r[0];if(r.length===
2)q[5]=r[1]}var c=[1,0,0,1,0,0],h=RegExp("^\\s*(?:(?:(?:(?:(matrix)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\))|(?:(translate)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(scale)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(rotate)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(skewX)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\))|(?:(skewY)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\)))(?:(?:\\s+,?\\s*|,\\s*)(?:(?:(matrix)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\))|(?:(translate)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(scale)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(rotate)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(skewX)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\))|(?:(skewY)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\))))*)?)\\s*$"),
o=RegExp("(?:(?:(matrix)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\))|(?:(translate)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(scale)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(rotate)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(skewX)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\))|(?:(skewY)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\)))");
return function(q){var r=c.concat();if(!q||q&&!h.test(q))return r;q.replace(o,function(u){var x=RegExp("(?:(?:(matrix)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\))|(?:(translate)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(scale)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(rotate)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(skewX)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\))|(?:(skewY)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\)))").exec(u).filter(function(t){return t!==
""&&t!=null});u=x[1];x=x.slice(2).map(parseFloat);switch(u){case "translate":a(r,x);break;case "rotate":d(r,x);break;case "scale":b(r,x);break;case "skewX":r[2]=x[0];break;case "skewY":r[1]=x[0];break;case "matrix":r=x;break}});return r}}();k.parseSVGDocument=function(){var d=/^(path|circle|polygon|polyline|ellipse|rect|line)$/,b=RegExp("^\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)+)\\s*,?\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)+)\\s*,?\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)+)\\s*,?\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)+)\\s*$");
return function(a,c){if(a){var h=k.util.toArray(a.getElementsByTagName("*")).filter(function(t){var v;if(v=d.test(t.tagName)){a:{for(t=t;t&&(t=t.parentNode);)if(t.nodeName==="pattern"){t=true;break a}t=false}v=!t}return v});if(!(!h||h&&!h.length)){var o=a.getAttribute("viewBox"),q=a.getAttribute("width"),r=a.getAttribute("height"),u=null,x=null;if(o&&(o=o.match(b))){parseInt(o[1],10);parseInt(o[2],10);u=parseInt(o[3],10);x=parseInt(o[4],10)}u=q?parseFloat(q):u;x=r?parseFloat(r):x;o={width:u,height:x};
h=k.parseElements(h,l(o));!h||h&&!h.length||c&&c(h,o)}}}}();p(k,{parseAttributes:function(d,b){if(d){var a,c,h={};if(d.parentNode&&/^g$/i.test(d.parentNode.nodeName))h=k.parseAttributes(d.parentNode,b);var o=b.reduce(function(q,r){a=d.getAttribute(r);c=parseFloat(a);if(a){if((r==="fill"||r==="stroke")&&a==="none")a="";if(r==="fill-rule")a=a==="evenodd"?"destination-over":a;if(r==="transform")a=k.parseTransformAttribute(a);if(r in g)r=g[r];q[r]=isNaN(c)?a:c}return q},{});o=p(k.parseStyleAttribute(d),
o);return p(h,o)}},parseElements:function(d,b){var a=d.map(function(c){var h=k[e(c.tagName)];if(h&&h.fromElement)try{return h.fromElement(c,b)}catch(o){console.log(o.message||o)}});return a=a.filter(function(c){return c!=null})},parseStyleAttribute:function(d){var b={};if(d=d.getAttribute("style"))if(typeof d=="string"){d=d.split(";");d.pop();b=d.reduce(function(c,h){var o=h.split(":"),q=o[0].trim();o=o[1].trim();c[q]=o;return c},{})}else for(var a in d)if(typeof d[a]!=="undefined")b[a]=d[a];return b},
parsePointsAttribute:function(d){if(!d)return null;d=d.trim();var b=d.indexOf(",")>-1;d=d.split(/\s+/);var a=[];if(b){b=0;for(var c=d.length;b<c;b++){var h=d[b].split(",");a.push({x:parseFloat(h[0]),y:parseFloat(h[1])})}}else{b=0;for(c=d.length;b<c;b+=2)a.push({x:parseFloat(d[b]),y:parseFloat(d[b+1])})}return a}})})();
(function(){function k(e,l){arguments.length>0&&this.init(e,l)}var p=this.fabric||(this.fabric={});if(p.Point)console.warn("fabric.Point is already defined");else{k.prototype={constructor:k,init:function(e,l){this.x=e;this.y=l},add:function(e){return new k(this.x+e.x,this.y+e.y)},addEquals:function(e){this.x+=e.x;this.y+=e.y;return this},scalarAdd:function(e){return new k(this.x+e,this.y+e)},scalarAddEquals:function(e){this.x+=e;this.y+=e;return this},subtract:function(e){return new k(this.x-e.x,
this.y-e.y)},subtractEquals:function(e){this.x-=e.x;this.y-=e.y;return this},scalarSubtract:function(e){return new k(this.x-e,this.y-e)},scalarSubtractEquals:function(e){this.x-=e;this.y-=e;return this},multiply:function(e){return new k(this.x*e,this.y*e)},multiplyEquals:function(e){this.x*=e;this.y*=e;return this},divide:function(e){return new k(this.x/e,this.y/e)},divideEquals:function(e){this.x/=e;this.y/=e;return this},eq:function(e){return this.x==e.x&&this.y==e.y},lt:function(e){return this.x<
e.x&&this.y<e.y},lte:function(e){return this.x<=e.x&&this.y<=e.y},gt:function(e){return this.x>e.x&&this.y>e.y},gte:function(e){return this.x>=e.x&&this.y>=e.y},lerp:function(e,l){return new k(this.x+(e.x-this.x)*l,this.y+(e.y-this.y)*l)},distanceFrom:function(e){var l=this.x-e.x;e=this.y-e.y;return Math.sqrt(l*l+e*e)},min:function(e){return new k(Math.min(this.x,e.x),Math.min(this.y,e.y))},max:function(e){return new k(Math.max(this.x,e.x),Math.max(this.y,e.y))},toString:function(){return this.x+
","+this.y},setXY:function(e,l){this.x=e;this.y=l},setFromPoint:function(e){this.x=e.x;this.y=e.y},swap:function(e){var l=this.x,g=this.y;this.x=e.x;this.y=e.y;e.x=l;e.y=g}};p.Point=k}})();
(function(){function k(e){arguments.length>0&&this.init(e)}var p=this.fabric||(this.fabric={});if(p.Intersection)console.warn("fabric.Intersection is already defined");else{k.prototype.init=function(e){this.status=e;this.points=[]};k.prototype.appendPoint=function(e){this.points.push(e)};k.prototype.appendPoints=function(e){this.points=this.points.concat(e)};k.intersectLineLine=function(e,l,g,d){var b,a=(d.x-g.x)*(e.y-g.y)-(d.y-g.y)*(e.x-g.x);b=(l.x-e.x)*(e.y-g.y)-(l.y-e.y)*(e.x-g.x);g=(d.y-g.y)*
(l.x-e.x)-(d.x-g.x)*(l.y-e.y);if(g!=0){a=a/g;b=b/g;if(0<=a&&a<=1&&0<=b&&b<=1){b=new k("Intersection");b.points.push(new p.Point(e.x+a*(l.x-e.x),e.y+a*(l.y-e.y)))}else b=new k("No Intersection")}else b=a==0||b==0?new k("Coincident"):new k("Parallel");return b};k.intersectLinePolygon=function(e,l,g){for(var d=new k("No Intersection"),b=g.length,a=0;a<b;a++){var c=k.intersectLineLine(e,l,g[a],g[(a+1)%b]);d.appendPoints(c.points)}if(d.points.length>0)d.status="Intersection";return d};k.intersectPolygonPolygon=
function(e,l){for(var g=new k("No Intersection"),d=e.length,b=0;b<d;b++){var a=k.intersectLinePolygon(e[b],e[(b+1)%d],l);g.appendPoints(a.points)}if(g.points.length>0)g.status="Intersection";return g};k.intersectPolygonRectangle=function(e,l,g){var d=l.min(g),b=l.max(g);g=new p.Point(b.x,d.y);var a=new p.Point(d.x,b.y);l=k.intersectLinePolygon(d,g,e);g=k.intersectLinePolygon(g,b,e);b=k.intersectLinePolygon(b,a,e);e=k.intersectLinePolygon(a,d,e);d=new k("No Intersection");d.appendPoints(l.points);
d.appendPoints(g.points);d.appendPoints(b.points);d.appendPoints(e.points);if(d.points.length>0)d.status="Intersection";return d};p.Intersection=k}})();
(function(){function k(e){e?this._tryParsingColor(e):this.setSource([0,0,0,1])}var p=this.fabric||(this.fabric={});if(p.Color)console.warn("fabric.Color is already defined.");else{p.Color=k;k.prototype._tryParsingColor=function(e){var l=k.sourceFromHex(e);l||(l=k.sourceFromRgb(e));l&&this.setSource(l)};k.prototype.getSource=function(){return this._source};k.prototype.setSource=function(e){this._source=e};k.prototype.toRgb=function(){var e=this.getSource();return"rgb("+e[0]+","+e[1]+","+e[2]+")"};
k.prototype.toRgba=function(){var e=this.getSource();return"rgba("+e[0]+","+e[1]+","+e[2]+","+e[3]+")"};k.prototype.toHex=function(){var e=this.getSource(),l=e[0].toString(16);l=l.length==1?"0"+l:l;var g=e[1].toString(16);g=g.length==1?"0"+g:g;e=e[2].toString(16);e=e.length==1?"0"+e:e;return l.toUpperCase()+g.toUpperCase()+e.toUpperCase()};k.prototype.getAlpha=function(){return this.getSource()[3]};k.prototype.setAlpha=function(e){var l=this.getSource();l[3]=e;this.setSource(l);return this};k.prototype.toGrayscale=
function(){var e=this.getSource(),l=parseInt((e[0]*0.3+e[1]*0.59+e[2]*0.11).toFixed(0),10);this.setSource([l,l,l,e[3]]);return this};k.prototype.toBlackWhite=function(e){var l=this.getSource(),g=(l[0]*0.3+l[1]*0.59+l[2]*0.11).toFixed(0);l=l[3];e=e||127;g=Number(g)<Number(e)?0:255;this.setSource([g,g,g,l]);return this};k.prototype.overlayWith=function(e){e=new k(e);var l=[],g=this.getAlpha(),d=this.getSource();e=e.getSource();for(var b=0;b<3;b++)l.push(Math.round(d[b]*0.5+e[b]*0.5));l[4]=g;this.setSource(l);
return this};k.reRGBa=/^rgba?\((\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})(?:\s*,\s*(\d+(?:\.\d+)?))?\)$/;k.reHex=/^#?([0-9a-f]{6}|[0-9a-f]{3})$/i;k.fromRgb=function(e){return k.fromSource(k.sourceFromRgb(e))};k.sourceFromRgb=function(e){if(e=e.match(k.reRGBa))return[parseInt(e[1],10),parseInt(e[2],10),parseInt(e[3],10),e[4]?parseFloat(e[4]):1]};k.fromRgba=k.fromRgb;k.fromHex=function(e){return k.fromSource(k.sourceFromHex(e))};k.sourceFromHex=function(e){if(e.match(k.reHex)){var l=e.slice(e.indexOf("#")+
1),g=l.length===3;e=g?l.charAt(0)+l.charAt(0):l.substring(0,2);var d=g?l.charAt(1)+l.charAt(1):l.substring(2,4);l=g?l.charAt(2)+l.charAt(2):l.substring(4,6);return[parseInt(e,16),parseInt(d,16),parseInt(l,16),1]}};k.fromSource=function(e){var l=new k;l.setSource(e);return l}}})();
(function(){if(fabric.Element)console.warn("fabric.Element is already defined.");else{var k=this.window,p=k.document,e=fabric.util.object.extend,l=fabric.util.string.capitalize,g=fabric.util.string.camelize,d=fabric.util.fireEvent,b=fabric.util.getPointer,a=fabric.util.getElementOffset,c=fabric.util.removeFromArray,h=fabric.util.addListener,o=fabric.util.removeListener,q=fabric.util.array.min,r=fabric.util.array.max,u=Math.sqrt,x=Math.pow,t=Math.atan2,v=Math.abs,w=Math.min,A=Math.max,D=Error("Could not initialize `canvas` element"),
G={tr:"ne-resize",br:"se-resize",bl:"sw-resize",tl:"nw-resize",ml:"w-resize",mt:"n-resize",mr:"e-resize",mb:"s-resize"};fabric.Element=function(f,m){this._groupSelector=null;this._objects=[];this._activeGroup=this._currentTransform=this._element=this._context=null;this._freeDrawingXPoints=[];this._freeDrawingYPoints=[];this._config={width:300,height:150};m=m||{};this._initElement(f);this._initConfig(m);m.overlayImage&&this.setOverlayImage(m.overlayImage);if(m.afterRender)this.afterRender=m.afterRender;
this._createCanvasBackground();this._createCanvasContainer();this._initEvents();this.calcOffset()};e(fabric.Element.prototype,{selectionColor:"rgba(100, 100, 255, 0.3)",selectionBorderColor:"rgba(255, 255, 255, 0.3)",freeDrawingColor:"rgb(0, 0, 0)",backgroundColor:"rgba(0, 0, 0, 0)",freeDrawingLineWidth:1,selectionLineWidth:1,includeDefaultValues:true,shouldCacheImages:false,CANVAS_WIDTH:600,CANVAS_HEIGHT:600,onBeforeScaleRotate:function(){},onFpsUpdate:function(){},calcOffset:function(){this._offset=
a(this.getElement());return this},setOverlayImage:function(f,m){if(f){var n=this,s=new Image;s.onload=function(){n.overlayImage=s;m&&m();s=s.onload=null};s.src=f}return this},_initElement:function(f){this._element=fabric.util.getById(f)||p.createElement("canvas");typeof this._element.getContext==="undefined"&&typeof G_vmlCanvasManager!=="undefined"&&G_vmlCanvasManager.initElement(this._element);if(typeof this._element.getContext==="undefined")throw D;if(!(this.contextTop=this._element.getContext("2d")))throw D;
f=this._element.width||0;var m=this._element.height||0;this._initWrapperElement(f,m);this._setElementStyle(f,m)},_initWrapperElement:function(f,m){var n=fabric.util.wrapElement(this.getElement(),"div",{"class":"canvas_container"});fabric.util.setStyle(n,{width:f+"px",height:m+"px"});fabric.util.makeElementUnselectable(n);this.wrapper=n},_setElementStyle:function(f,m){fabric.util.setStyle(this.getElement(),{position:"absolute",width:f+"px",height:m+"px",left:0,top:0})},_initConfig:function(f){e(this._config,
f||{});this._config.width=parseInt(this._element.width,10)||0;this._config.height=parseInt(this._element.height,10)||0;this._element.style.width=this._config.width+"px";this._element.style.height=this._config.height+"px"},_initEvents:function(){var f=this;this._onMouseDown=function(m){f.__onMouseDown(m)};this._onMouseUp=function(m){f.__onMouseUp(m)};this._onMouseMove=function(m){f.__onMouseMove(m)};this._onResize=function(){f.calcOffset()};h(this._element,"mousedown",this._onMouseDown);h(p,"mousemove",
this._onMouseMove);h(p,"mouseup",this._onMouseUp);h(k,"resize",this._onResize)},_createCanvasElement:function(f){var m=p.createElement("canvas");if(m){m.className=f;f=this._element.parentNode.insertBefore(m,this._element);f.width=this.getWidth();f.height=this.getHeight();f.style.width=this.getWidth()+"px";f.style.height=this.getHeight()+"px";f.style.position="absolute";f.style.left=0;f.style.top=0;typeof m.getContext==="undefined"&&typeof G_vmlCanvasManager!=="undefined"&&G_vmlCanvasManager.initElement(m);
if(typeof m.getContext==="undefined")throw D;fabric.util.makeElementUnselectable(f);return f}},_createCanvasContainer:function(){var f=this._createCanvasElement("canvas-container");this.contextContainerEl=f;this.contextContainer=f.getContext("2d")},_createCanvasBackground:function(){var f=this._createCanvasElement("canvas-container");this._contextBackgroundEl=f;this._contextBackground=f.getContext("2d")},getWidth:function(){return this._config.width},getHeight:function(){return this._config.height},
setWidth:function(f){return this._setDimension("width",f)},setHeight:function(f){return this._setDimension("height",f)},setDimensions:function(f){for(var m in f)this._setDimension(m,f[m]);return this},_setDimension:function(f,m){this.contextContainerEl[f]=m;this.contextContainerEl.style[f]=m+"px";this._contextBackgroundEl[f]=m;this._contextBackgroundEl.style[f]=m+"px";this._element[f]=m;this._element.style[f]=m+"px";this._element.parentNode.style[f]=m+"px";this._config[f]=m;this.calcOffset();this.renderAll();
return this},__onMouseUp:function(f){if(this.isDrawingMode&&this._isCurrentlyDrawing)this._finalizeDrawingPath();else{if(this._currentTransform){var m=this._currentTransform.target;if(m._scaling){d("object:scaled",{target:m});m._scaling=false}for(var n=this._objects.length;n--;)this._objects[n].setCoords();if(m.hasStateChanged()){m.isMoving=false;d("object:modified",{target:m})}}this._currentTransform=null;this._groupSelector&&this._findSelectedObjects(f);if(n=this.getActiveGroup()){n.hasStateChanged()&&
n.containsPoint(this.getPointer(f))&&d("group:modified",{target:n});n.setObjectsCoords();n.set("isMoving",false);this._setCursor("default")}this._groupSelector=null;this.renderAll();this._setCursorFromEvent(f,m);this._setCursor("");var s=this;setTimeout(function(){s._setCursorFromEvent(f,m)},50)}},_shouldClearSelection:function(f){var m=this.findTarget(f),n=this.getActiveGroup();return!m||m&&n&&!n.contains(m)&&n!==m&&!f.shiftKey},__onMouseDown:function(f){if(this.isDrawingMode){this._prepareForDrawing(f);
this._captureDrawingPath(f)}else if(!this._currentTransform){var m=this.findTarget(f),n=this.getPointer(f),s=this.getActiveGroup();if(this._shouldClearSelection(f)){this._groupSelector={ex:n.x,ey:n.y,top:0,left:0};this.deactivateAllWithDispatch()}else{m.saveState();m._findTargetCorner(f,this._offset)&&this.onBeforeScaleRotate(m);this._setupCurrentTransform(f,m);if(f.shiftKey&&(s||this.getActiveObject()))this._handleGroupLogic(f,m);else{m!==this.getActiveGroup()&&this.deactivateAll();this.setActiveObject(m)}}this.renderAll()}},
getElement:function(){return this._element},deactivateAllWithDispatch:function(){var f=this.getActiveGroup();f&&d("before:group:destroyed",{target:f});this.deactivateAll();f&&d("after:group:destroyed");d("selection:cleared");return this},_setupCurrentTransform:function(f,m){var n="drag",s,y=b(f);if(s=m._findTargetCorner(f,this._offset))n=s==="ml"||s==="mr"?"scaleX":s==="mt"||s==="mb"?"scaleY":"rotate";this._currentTransform={target:m,action:n,scaleX:m.scaleX,scaleY:m.scaleY,offsetX:y.x-m.left,offsetY:y.y-
m.top,ex:y.x,ey:y.y,left:m.left,top:m.top,theta:m.theta,width:m.width*m.scaleX};this._currentTransform.original={left:m.left,top:m.top}},_handleGroupLogic:function(f,m){if(m.isType("group")){m=this.findTarget(f,true);if(!m||m.isType("group"))return}var n=this.getActiveGroup();if(n){if(n.contains(m)){n.remove(m);m.setActive(false);n.size()===1&&this.removeActiveGroup()}else n.add(m);d("group:selected",{target:n});n.setActive(true)}else{if(this._activeObject)if(m!==this._activeObject){this.setActiveGroup(new fabric.Group([this._activeObject,
m]));n=this.getActiveGroup()}m.setActive(true)}n&&n.saveCoords()},_prepareForDrawing:function(f){this._isCurrentlyDrawing=true;this.removeActiveObject().renderAll();f=this.getPointer(f);this._freeDrawingXPoints.length=this._freeDrawingYPoints.length=0;this._freeDrawingXPoints.push(f.x);this._freeDrawingYPoints.push(f.y);this.contextTop.beginPath();this.contextTop.moveTo(f.x,f.y);this.contextTop.strokeStyle=this.freeDrawingColor;this.contextTop.lineWidth=this.freeDrawingLineWidth;this.contextTop.lineCap=
this.contextTop.lineJoin="round"},_captureDrawingPath:function(f){f=this.getPointer(f);this._freeDrawingXPoints.push(f.x);this._freeDrawingYPoints.push(f.y);this.contextTop.lineTo(f.x,f.y);this.contextTop.stroke()},_finalizeDrawingPath:function(){this.contextTop.closePath();this._isCurrentlyDrawing=false;var f=q(this._freeDrawingXPoints),m=q(this._freeDrawingYPoints),n=r(this._freeDrawingXPoints),s=r(this._freeDrawingYPoints),y=[],z=this._freeDrawingXPoints,B=this._freeDrawingYPoints;y.push("M ",
z[0]-f," ",B[0]-m," ");for(var C=1;xPoint=z[C],yPoint=B[C];C++)y.push("L ",xPoint-f," ",yPoint-m," ");y=new fabric.Path(y.join(""));y.fill=null;y.stroke=this.freeDrawingColor;y.strokeWidth=this.freeDrawingLineWidth;this.add(y);y.set("left",f+(n-f)/2).set("top",m+(s-m)/2).setCoords();this.renderAll();d("path:created",{path:y})},__onMouseMove:function(f){if(this.isDrawingMode)this._isCurrentlyDrawing&&this._captureDrawingPath(f);else{var m=this._groupSelector;if(m!==null){var n=b(f);m.left=n.x-this._offset.left-
m.ex;m.top=n.y-this._offset.top-m.ey;this.renderTop()}else if(this._currentTransform){n=b(f);m=n.x;n=n.y;this._currentTransform.target.isMoving=true;if(this._currentTransform.action==="rotate"){f.shiftKey||this._rotateObject(m,n);this._scaleObject(m,n)}else if(this._currentTransform.action==="scaleX")this._scaleObject(m,n,"x");else this._currentTransform.action==="scaleY"?this._scaleObject(m,n,"y"):this._translateObject(m,n);this.renderAll()}else{n=this._element.style;if(m=this.findTarget(f)){this._setCursorFromEvent(f,
m);m.isActive()&&m.setCornersVisibility&&m.setCornersVisibility(true)}else{for(f=this._objects.length;f--;)this._objects[f].active||this._objects[f].setActive(false);n.cursor="default"}}}},_translateObject:function(f,m){var n=this._currentTransform.target;n.lockHorizontally||n.set("left",f-this._currentTransform.offsetX);n.lockVertically||n.set("top",m-this._currentTransform.offsetY)},_scaleObject:function(f,m,n){var s=this._currentTransform,y=this._offset,z=s.target;if(!z.lockScaling){var B=u(x(s.ey-
s.top-y.top,2)+x(s.ex-s.left-y.left,2));f=u(x(m-s.top-y.top,2)+x(f-s.left-y.left,2));z._scaling=true;if(n)if(n==="x")z.set("scaleX",s.scaleX*f/B);else n==="y"&&z.set("scaleY",s.scaleY*f/B);else{z.set("scaleX",s.scaleX*f/B);z.set("scaleY",s.scaleY*f/B)}}},_rotateObject:function(f,m){var n=this._currentTransform,s=this._offset;if(!n.target.lockRotation){var y=t(n.ey-n.top-s.top,n.ex-n.left-s.left);s=t(m-n.top-s.top,f-n.left-s.left);n.target.set("theta",s-y+n.theta)}},_setCursor:function(f){this._element.style.cursor=
f},_setCursorFromEvent:function(f,m){var n=this._element.style;if(m){var s=this.getActiveGroup();if(s=!!m._findTargetCorner&&(!s||!s.contains(m))&&m._findTargetCorner(f,this._offset))if(s in G)n.cursor=G[s];else{n.cursor="default";return false}else n.cursor="move"}else{n.cursor="default";return false}return true},_draw:function(f,m){m&&m.render(f)},_drawSelection:function(){var f=this._groupSelector,m=f.left,n=f.top,s=v(m),y=v(n);this.contextTop.fillStyle=this.selectionColor;this.contextTop.fillRect(f.ex-
(m>0?0:-m),f.ey-(n>0?0:-n),s,y);this.contextTop.lineWidth=this.selectionLineWidth;this.contextTop.strokeStyle=this.selectionBorderColor;this.contextTop.strokeRect(f.ex+0.5-(m>0?0:s),f.ey+0.5-(n>0?0:y),s,y)},_findSelectedObjects:function(){var f=[],m=this._groupSelector.ex,n=this._groupSelector.ey,s=m+this._groupSelector.left,y=n+this._groupSelector.top,z=new fabric.Point(w(m,s),w(n,y));n=new fabric.Point(A(m,s),A(n,y));s=0;for(y=this._objects.length;s<y;++s){m=this._objects[s];if(m.intersectsWithRect(z,
n)||m.isContainedWithinRect(z,n)){m.setActive(true);f.push(m)}}if(f.length===1){this.setActiveObject(f[0]);d("object:selected",{target:f[0]})}else if(f.length>1){f=new fabric.Group(f);this.setActiveGroup(f);f.saveCoords();d("group:selected",{target:f})}this.renderAll()},add:function(){this._objects.push.apply(this._objects,arguments);this.renderAll();return this},insertAt:function(f,m){this._objects.splice(m,0,f);this.renderAll();return this},getObjects:function(){return this._objects},getContext:function(){return this.contextTop},
clearContext:function(f){f.clearRect(0,0,this._config.width,this._config.height);return this},clear:function(){this._objects.length=0;this.clearContext(this.contextTop);this.clearContext(this.contextContainer);this.renderAll();return this},renderAll:function(f){var m=this._config.width,n=this._config.height,s=f?this.contextTop:this.contextContainer;this.clearContext(this.contextTop);f||this.clearContext(s);s.fillStyle=this.backgroundColor;s.fillRect(0,0,m,n);f=this._objects.length;m=this.getActiveGroup();
n=new Date;if(f)for(var y=0;y<f;++y)if(!m||m&&!m.contains(this._objects[y]))this._draw(s,this._objects[y]);m&&this._draw(this.contextTop,m);this.overlayImage&&this.contextTop.drawImage(this.overlayImage,0,0);this.onFpsUpdate(~~(1E3/(new Date-n)));this.afterRender&&this.afterRender();return this},renderTop:function(){this.clearContext(this.contextTop);this.overlayImage&&this.contextTop.drawImage(this.overlayImage,0,0);this._groupSelector&&this._drawSelection();var f=this.getActiveGroup();f&&f.render(this.contextTop);
this.afterRender&&this.afterRender();return this},containsPoint:function(f,m){var n=this.getPointer(f),s=this._normalizePointer(m,n);n=s.x;s=s.y;var y=m._getImageLines(m.oCoords);if((n=m._findCrossPoints(n,s,y))&&n%2===1||m._findTargetCorner(f,this._offset))return true;return false},_normalizePointer:function(f,m){var n=this.getActiveGroup(),s=m.x,y=m.y;if(n&&f.type!=="group"&&n.contains(f)){s-=n.left;y-=n.top}return{x:s,y:y}},findTarget:function(f,m){var n;this.getPointer(f);var s=this.getActiveGroup();
if(s&&!m&&this.containsPoint(f,s))return n=s;for(s=this._objects.length;s--;)if(this.containsPoint(f,this._objects[s])){this.relatedTarget=n=this._objects[s];break}return n},toDataURL:function(f){var m;f||(f="png");if(f==="jpeg"||f==="png"){this.renderAll(true);m=this.getElement().toDataURL("image/"+f);this.renderAll()}return m},toDataURLWithMultiplier:function(f,m){var n=this.getWidth(),s=this.getHeight(),y=n*m,z=s*m,B=this.getActiveObject();this.setWidth(y).setHeight(z);this.contextTop.scale(m,
m);B&&this.deactivateAll().renderAll();y=this.toDataURL(f);this.contextTop.scale(1/m,1/m);this.setWidth(n).setHeight(s);B&&this.setActiveObject(B);this.renderAll();return y},getPointer:function(f){f=b(f);return{x:f.x-this._offset.left,y:f.y-this._offset.top}},getCenter:function(){return{top:this.getHeight()/2,left:this.getWidth()/2}},centerObjectH:function(f){f.set("left",this.getCenter().left);this.renderAll();return this},fxCenterObjectH:function(f,m){m=m||{};var n=function(){},s=m.onComplete||
n,y=m.onChange||n,z=this;fabric.util.animate({startValue:f.get("left"),endValue:this.getCenter().left,duration:this.FX_DURATION,onChange:function(B){f.set("left",B);z.renderAll();y()},onComplete:function(){f.setCoords();s()}});return this},centerObjectV:function(f){f.set("top",this.getCenter().top);this.renderAll();return this},fxCenterObjectV:function(f,m){m=m||{};var n=function(){},s=m.onComplete||n,y=m.onChange||n,z=this;fabric.util.animate({startValue:f.get("top"),endValue:this.getCenter().top,
duration:this.FX_DURATION,onChange:function(B){f.set("top",B);z.renderAll();y()},onComplete:function(){f.setCoords();s()}});return this},straightenObject:function(f){f.straighten();this.renderAll();return this},fxStraightenObject:function(f){f.fxStraighten({onChange:this.renderAll.bind(this)});return this},toDatalessJSON:function(){return this.toDatalessObject()},toObject:function(){return this._toObjectMethod("toObject")},toDatalessObject:function(){return this._toObjectMethod("toDatalessObject")},
_toObjectMethod:function(f){return{objects:this._objects.map(function(m){if(!this.includeDefaultValues){var n=m.includeDefaultValues;m.includeDefaultValues=false}var s=m[f]();if(!this.includeDefaultValues)m.includeDefaultValues=n;return s},this),background:this.backgroundColor}},isEmpty:function(){return this._objects.length===0},loadFromJSON:function(f,m){if(f){var n=JSON.parse(f);if(!(!n||n&&!n.objects)){this.clear();var s=this;this._enlivenObjects(n.objects,function(){s.backgroundColor=n.background;
m&&m()});return this}}},_enlivenObjects:function(f,m){var n=0,s=f.filter(function(z){return z.type==="image"}).length,y=this;f.forEach(function(z,B){if(z.type)switch(z.type){case "image":case "font":fabric[l(z.type)].fromObject(z,function(F){y.insertAt(F,B);++n===s&&m&&m()});break;default:var C=fabric[g(l(z.type))];C&&C.fromObject&&y.insertAt(C.fromObject(z),B);break}});s===0&&m&&m()},loadFromDatalessJSON:function(f,m){if(f){var n=typeof f==="string"?JSON.parse(f):f;if(!(!n||n&&!n.objects)){this.clear();
this.backgroundColor=n.background;this._enlivenDatalessObjects(n.objects,m)}}},_enlivenDatalessObjects:function(f,m){function n(C,F){s.insertAt(C,F);C.setCoords();++y===z&&m&&m()}var s=this,y=0,z=f.length;z===0&&m&&m();try{f.forEach(function(C,F){var I=C.paths?"paths":"path",H=C[I];delete C[I];if(typeof H!=="string")switch(C.type){case "image":case "text":fabric[l(C.type)].fromObject(C,function(E){n(E,F)});break;default:(I=fabric[g(l(C.type))])&&I.fromObject&&n(I.fromObject(C),F);break}else if(C.type===
"image")s.loadImageFromURL(H,function(E){E.setSourcePath(H);e(E,C);E.setAngle(C.angle);n(E,F)});else if(C.type==="text"){C.path=H;var J=fabric.Text.fromObject(C);fabric.util.getScript(H,function(){Object.prototype.toString.call(k.opera)==="[object Opera]"?setTimeout(function(){n(J,F)},500):n(J,F)})}else s.loadSVGFromURL(H,function(E){E=E.length>1?new fabric.PathGroup(E,C):E[0];E.setSourcePath(H);if(!(E instanceof fabric.PathGroup)){e(E,C);typeof C.angle!=="undefined"&&E.setAngle(C.angle)}n(E,F)})},
this)}catch(B){console.log(B.message)}},loadImageFromURL:function(){var f={};return function(m,n){function s(){var B=p.getElementById(f[m]);B.width&&B.height?n(new fabric.Image(B)):setTimeout(s,50)}var y=this;if(f[m])s();else{var z=new Image;z.onload=function(){z.onload=null;y._resizeImageToFit(z);var B=new fabric.Image(z);n(B)};z.className="canvas-img-clone";z.src=m;if(this.shouldCacheImages)f[m]=Element.identify(z);p.body.appendChild(z)}}}(),loadSVGFromURL:function(f,m){function n(z){if(z=z.responseXML)(z=
z.documentElement)&&fabric.parseSVGDocument(z,function(B,C){y.cache.set(f,{objects:B.invoke("toObject"),options:C});m(B,C)})}function s(){console.log("ERROR!")}var y=this;f=f.replace(/^\n\s*/,"").replace(/\?.*$/,"").trim();this.cache.has(f,function(z){if(z)y.cache.get(f,function(B){B=y._enlivenCachedObject(B);m(B.objects,B.options)});else new Ajax.Request(f,{method:"get",onComplete:n,onFailure:s})})},_enlivenCachedObject:function(f){var m=f.objects;f=f.options;m=m.map(function(n){return fabric[l(n.type)].fromObject(n)});
return{objects:m,options:f}},remove:function(f){c(this._objects,f);this.renderAll();return f},fxRemove:function(f,m){var n=this;f.fxRemove({onChange:this.renderAll.bind(this),onComplete:function(){n.remove(f);typeof m==="function"&&m()}});return this},sendToBack:function(f){c(this._objects,f);this._objects.unshift(f);return this.renderAll()},bringToFront:function(f){c(this._objects,f);this._objects.push(f);return this.renderAll()},sendBackwards:function(f){var m=this._objects.indexOf(f),n=m;if(m!==
0){for(m=m-1;m>=0;--m)if(f.intersectsWithObject(this._objects[m])){n=m;break}c(this._objects,f);this._objects.splice(n,0,f)}return this.renderAll()},bringForward:function(f){var m=this.getObjects(),n=m.indexOf(f),s=n;if(n!==m.length-1){n=n+1;for(var y=this._objects.length;n<y;++n)if(f.intersectsWithObject(m[n])){s=n;break}c(m,f);m.splice(s,0,f)}this.renderAll()},setActiveObject:function(f){this._activeObject&&this._activeObject.setActive(false);this._activeObject=f;f.setActive(true);this.renderAll();
d("object:selected",{target:f});return this},getActiveObject:function(){return this._activeObject},removeActiveObject:function(){this._activeObject&&this._activeObject.setActive(false);this._activeObject=null;return this},setActiveGroup:function(f){this._activeGroup=f;return this},getActiveGroup:function(){return this._activeGroup},removeActiveGroup:function(){var f=this.getActiveGroup();f&&f.destroy();return this.setActiveGroup(null)},item:function(f){return this.getObjects()[f]},deactivateAll:function(){for(var f=
this.getObjects(),m=0,n=f.length;m<n;m++)f[m].setActive(false);this.removeActiveGroup();this.removeActiveObject();return this},complexity:function(){return this.getObjects().reduce(function(f,m){f+=m.complexity?m.complexity():0;return f},0)},dispose:function(){this.clear();o(this.getElement(),"mousedown",this._onMouseDown);o(p,"mouseup",this._onMouseUp);o(p,"mousemove",this._onMouseMove);o(k,"resize",this._onResize);return this},clone:function(f){var m=p.createElement("canvas");m.width=this.getWidth();
m.height=this.getHeight();var n=this.__clone||(this.__clone=new fabric.Element(m));return n.loadFromJSON(JSON.stringify(this.toJSON()),function(){f&&f(n)})},_toDataURL:function(f,m){this.clone(function(n){m(n.toDataURL(f))})},_toDataURLWithMultiplier:function(f,m,n){this.clone(function(s){n(s.toDataURLWithMultiplier(f,m))})},_resizeImageToFit:function(f){var m=f.width||f.offsetWidth,n=this.getWidth()/m;if(m)f.width=m*n},cache:{has:function(f,m){m(false)},get:function(){},set:function(){}}});fabric.Element.prototype.toString=
function(){return"#<fabric.Element ("+this.complexity()+"): { objects: "+this.getObjects().length+" }>"};e(fabric.Element,{EMPTY_JSON:'{"objects": [], "background": "white"}',toGrayscale:function(f){var m=f.getContext("2d");f=m.getImageData(0,0,f.width,f.height);var n=f.data,s=f.width,y=f.height,z,B;for(i=0;i<s;i++)for(j=0;j<y;j++){z=i*4*y+j*4;B=(n[z]+n[z+1]+n[z+2])/3;n[z]=B;n[z+1]=B;n[z+2]=B}m.putImageData(f,0,0)},supports:function(f){var m=p.createElement("canvas");typeof G_vmlCanvasManager!=="undefined"&&
G_vmlCanvasManager.initElement(m);if(!m||!m.getContext)return null;var n=m.getContext("2d");if(!n)return null;switch(f){case "getImageData":return typeof n.getImageData!=="undefined";case "toDataURL":return typeof m.toDataURL!=="undefined";default:return null}}});fabric.Element.prototype.toJSON=fabric.Element.prototype.toObject}})();
(function(){var k=this.fabric||(this.fabric={}),p=k.util.object.extend,e=k.util.object.clone,l=k.util.toFixed,g=k.util.string.capitalize,d=k.util.getPointer,b=Array.prototype.slice;if(!k.Object){k.Object=k.util.createClass({type:"object",includeDefaultValues:true,NUM_FRACTION_DIGITS:2,FX_DURATION:500,FX_TRANSITION:"decel",MIN_SCALE_LIMIT:0.1,stateProperties:"top left width height scaleX scaleY flipX flipY theta angle opacity cornersize fill overlayFill stroke strokeWidth fillRule borderScaleFactor transformMatrix".split(" "),
options:{top:0,left:0,width:100,height:100,scaleX:1,scaleY:1,flipX:false,flipY:false,theta:0,opacity:1,angle:0,cornersize:10,padding:0,borderColor:"rgba(102,153,255,0.75)",cornerColor:"rgba(102,153,255,0.5)",fill:"rgb(0,0,0)",overlayFill:null,stroke:null,strokeWidth:1,fillRule:"source-over",borderOpacityWhenMoving:0.4,borderScaleFactor:1,transformMatrix:null},callSuper:function(a){var c=this.constructor.superclass.prototype[a];return arguments.length>1?c.apply(this,b.call(arguments,1)):c.call(this)},
initialize:function(a){this.setOptions(a);this._importProperties();this.originalState={};this.setCoords();this.saveState()},setOptions:function(a){this.options=p(this._getOptions(),a)},_getOptions:function(){return p(e(this._getSuperOptions()),this.options)},_getSuperOptions:function(){var a=this.constructor;if(a)if(a=a.superclass)if((a=a.prototype)&&typeof a._getOptions=="function")return a._getOptions();return{}},_importProperties:function(){this.stateProperties.forEach(function(a){a==="angle"?
this.setAngle(this.options[a]):this[a]=this.options[a]},this)},transform:function(a){a.globalAlpha=this.opacity;a.translate(this.left,this.top);a.rotate(this.theta);a.scale(this.scaleX*(this.flipX?-1:1),this.scaleY*(this.flipY?-1:1))},toObject:function(){var a={type:this.type,left:l(this.left,this.NUM_FRACTION_DIGITS),top:l(this.top,this.NUM_FRACTION_DIGITS),width:l(this.width,this.NUM_FRACTION_DIGITS),height:l(this.height,this.NUM_FRACTION_DIGITS),fill:this.fill,overlayFill:this.overlayFill,stroke:this.stroke,
strokeWidth:this.strokeWidth,scaleX:l(this.scaleX,this.NUM_FRACTION_DIGITS),scaleY:l(this.scaleY,this.NUM_FRACTION_DIGITS),angle:l(this.getAngle(),this.NUM_FRACTION_DIGITS),flipX:this.flipX,flipY:this.flipY,opacity:l(this.opacity,this.NUM_FRACTION_DIGITS)};this.includeDefaultValues||(a=this._removeDefaultValues(a));return a},toDatalessObject:function(){return this.toObject()},_removeDefaultValues:function(a){var c=k.Object.prototype.options;this.stateProperties.forEach(function(h){a[h]===c[h]&&delete a[h]});
return a},isActive:function(){return!!this.active},setActive:function(a){this.active=!!a;return this},toString:function(){return"#<fabric."+g(this.type)+">"},set:function(a,c){if((a==="scaleX"||a==="scaleY")&&c<this.MIN_SCALE_LIMIT)c=this.MIN_SCALE_LIMIT;if(a==="angle")this.setAngle(c);else this[a]=c;return this},toggle:function(a){var c=this.get(a);typeof c==="boolean"&&this.set(a,!c);return this},setSourcePath:function(a){this.sourcePath=a;return this},get:function(a){return a==="angle"?this.getAngle():
this[a]},render:function(a,c){if(!(this.width===0||this.height===0)){a.save();var h=this.transformMatrix;h&&a.setTransform(h[0],h[1],h[2],h[3],h[4],h[5]);c||this.transform(a);if(this.stroke){a.lineWidth=this.strokeWidth;a.strokeStyle=this.stroke}if(this.overlayFill)a.fillStyle=this.overlayFill;else if(this.fill)a.fillStyle=this.fill;this._render(a,c);if(this.active&&!c){this.drawBorders(a);this.hideCorners||this.drawCorners(a)}a.restore()}},getWidth:function(){return this.width*this.scaleX},getHeight:function(){return this.height*
this.scaleY},scale:function(a){this.scaleY=this.scaleX=a;return this},scaleToWidth:function(a){return this.scale(a/this.width)},scaleToHeight:function(a){return this.scale(a/this.height)},setOpacity:function(a){this.set("opacity",a);return this},getAngle:function(){return this.theta*180/Math.PI},setAngle:function(a){this.theta=a/180*Math.PI;this.angle=a;return this},setCoords:function(){this.currentWidth=this.width*this.scaleX;this.currentHeight=this.height*this.scaleY;this._hypotenuse=Math.sqrt(Math.pow(this.currentWidth/
2,2)+Math.pow(this.currentHeight/2,2));this._angle=Math.atan(this.currentHeight/this.currentWidth);var a=Math.cos(this._angle+this.theta)*this._hypotenuse,c=Math.sin(this._angle+this.theta)*this._hypotenuse,h=this.theta,o=Math.sin(h);h=Math.cos(h);a={x:this.left-a,y:this.top-c};c={x:a.x+this.currentWidth*h,y:a.y+this.currentWidth*o};var q={x:a.x-this.currentHeight*o,y:a.y+this.currentHeight*h};this.oCoords={tl:a,tr:c,br:{x:c.x-this.currentHeight*o,y:c.y+this.currentHeight*h},bl:q,ml:{x:a.x-this.currentHeight/
2*o,y:a.y+this.currentHeight/2*h},mt:{x:a.x+this.currentWidth/2*h,y:a.y+this.currentWidth/2*o},mr:{x:c.x-this.currentHeight/2*o,y:c.y+this.currentHeight/2*h},mb:{x:q.x+this.currentWidth/2*h,y:q.y+this.currentWidth/2*o}};this._setCornerCoords();return this},drawBorders:function(a){var c=this.options,h=c.padding,o=h*2;a.save();a.globalAlpha=this.isMoving?c.borderOpacityWhenMoving:1;a.strokeStyle=c.borderColor;c=1/(this.scaleX<this.MIN_SCALE_LIMIT?this.MIN_SCALE_LIMIT:this.scaleX);var q=1/(this.scaleY<
this.MIN_SCALE_LIMIT?this.MIN_SCALE_LIMIT:this.scaleY);a.lineWidth=1/this.borderScaleFactor;a.scale(c,q);c=this.getWidth();q=this.getHeight();a.strokeRect(~~(-(c/2)-h)+0.5,~~(-(q/2)-h)+0.5,~~(c+o),~~(q+o));a.restore();return this},drawCorners:function(a){var c=this.options.cornersize,h=c/2,o=this.options.padding,q=-(this.width/2),r=-(this.height/2),u=c/this.scaleX,x=c/this.scaleY,t=(o+h)/this.scaleY,v=(o+h)/this.scaleX,w=(o+h-c)/this.scaleX;o=(o+h-c)/this.scaleY;a.save();a.globalAlpha=this.isMoving?
this.options.borderOpacityWhenMoving:1;a.fillStyle=this.options.cornerColor;c=q-v;h=r-t;a.fillRect(c,h,u,x);c=q+this.width-v;h=r-t;a.fillRect(c,h,u,x);c=q-v;h=r+this.height+o;a.fillRect(c,h,u,x);c=q+this.width+w;h=r+this.height+o;a.fillRect(c,h,u,x);c=q+this.width/2-v;h=r-t;a.fillRect(c,h,u,x);c=q+this.width/2-v;h=r+this.height+o;a.fillRect(c,h,u,x);c=q+this.width+w;h=r+this.height/2-t;a.fillRect(c,h,u,x);c=q-v;h=r+this.height/2-t;a.fillRect(c,h,u,x);a.restore();return this},clone:function(a){if(this.constructor.fromObject)return this.constructor.fromObject(this.toObject(),
a);return new k.Object(this.toObject())},cloneAsImage:function(a){if(k.Image){var c=new Image;c.onload=function(){a&&a(new k.Image(c),h);c=c.onload=null};var h={angle:this.get("angle"),flipX:this.get("flipX"),flipY:this.get("flipY")};this.set("angle",0).set("flipX",false).set("flipY",false);c.src=this.toDataURL()}return this},toDataURL:function(){var a=document.createElement("canvas");a.width=this.getWidth();a.height=this.getHeight();k.util.wrapElement(a,"div");var c=new k.Element(a);c.backgroundColor=
"transparent";c.renderAll();var h=this.clone();h.left=a.width/2;h.top=a.height/2;h.setActive(false);c.add(h);a=c.toDataURL("png");c.dispose();return a},hasStateChanged:function(){return this.stateProperties.some(function(a){return this[a]!==this.originalState[a]},this)},saveState:function(){this.stateProperties.forEach(function(a){this.originalState[a]=this.get(a)},this);return this},intersectsWithRect:function(a,c){var h=this.oCoords,o=new k.Point(h.tl.x,h.tl.y),q=new k.Point(h.tr.x,h.tr.y),r=new k.Point(h.bl.x,
h.bl.y);h=new k.Point(h.br.x,h.br.y);return k.Intersection.intersectPolygonRectangle([o,q,h,r],a,c).status==="Intersection"},intersectsWithObject:function(a){function c(o){return{tl:new k.Point(o.tl.x,o.tl.y),tr:new k.Point(o.tr.x,o.tr.y),bl:new k.Point(o.bl.x,o.bl.y),br:new k.Point(o.br.x,o.br.y)}}var h=c(this.oCoords);a=c(a.oCoords);return k.Intersection.intersectPolygonPolygon([h.tl,h.tr,h.br,h.bl],[a.tl,a.tr,a.br,a.bl]).status==="Intersection"},isContainedWithinRect:function(a,c){var h=this.oCoords,
o=new k.Point(h.tl.x,h.tl.y),q=new k.Point(h.tr.x,h.tr.y),r=new k.Point(h.bl.x,h.bl.y);new k.Point(h.br.x,h.br.y);return o.x>a.x&&q.x<c.x&&o.y>a.y&&r.y<c.y},isType:function(a){return this.type===a},_findTargetCorner:function(a,c){var h=d(a),o=h.x-c.left;h=h.y-c.top;var q;for(var r in this.oCoords){q=this._getImageLines(this.oCoords[r].corner,r);q=this._findCrossPoints(o,h,q);if(q%2==1&&q!=0)return this.__corner=r}return false},_findCrossPoints:function(a,c,h){var o,q,r,u=0;for(var x in h){r=h[x];
if(!(r.o.y<c&&r.d.y<c))if(!(r.o.y>=c&&r.d.y>=c)){if(r.o.x==r.d.x&&r.o.x>=a)o=r.o.x;else{o=(r.d.y-r.o.y)/(r.d.x-r.o.x);q=c-0*a;r=r.o.y-o*r.o.x;o=-(q-r)/(0-o)}if(o>=a)u+=1;if(u==2)break}}return u},_getImageLines:function(a){return{topline:{o:a.tl,d:a.tr},rightline:{o:a.tr,d:a.br},bottomline:{o:a.br,d:a.bl},leftline:{o:a.bl,d:a.tl}}},_setCornerCoords:function(){var a=this.oCoords,c=this.theta,h=this.cornersize*Math.cos(c),o=this.cornersize*Math.sin(c);c=this.cornersize/2;var q=c-o;a.tl.x-=q;a.tl.y-=
c;a.tl.corner={tl:{x:a.tl.x,y:a.tl.y},tr:{x:a.tl.x+h,y:a.tl.y+o},bl:{x:a.tl.x-o,y:a.tl.y+h}};a.tl.corner.br={x:a.tl.corner.tr.x-o,y:a.tl.corner.tr.y+h};a.tl.x+=q;a.tl.y+=c;a.tr.x+=c;a.tr.y-=c;a.tr.corner={tl:{x:a.tr.x-h,y:a.tr.y-o},tr:{x:a.tr.x,y:a.tr.y},br:{x:a.tr.x-o,y:a.tr.y+h}};a.tr.corner.bl={x:a.tr.corner.tl.x-o,y:a.tr.corner.tl.y+h};a.tr.x-=c;a.tr.y+=c;a.bl.x-=c;a.bl.y+=c;a.bl.corner={tl:{x:a.bl.x+o,y:a.bl.y-h},bl:{x:a.bl.x,y:a.bl.y},br:{x:a.bl.x+h,y:a.bl.y+o}};a.bl.corner.tr={x:a.bl.corner.br.x+
o,y:a.bl.corner.br.y-h};a.bl.x+=c;a.bl.y-=c;a.br.x+=c;a.br.y+=c;a.br.corner={tr:{x:a.br.x+o,y:a.br.y-h},bl:{x:a.br.x-h,y:a.br.y-o},br:{x:a.br.x,y:a.br.y}};a.br.corner.tl={x:a.br.corner.bl.x+o,y:a.br.corner.bl.y-h};a.br.x-=c;a.br.y-=c;a.ml.x-=c;a.ml.y-=c;a.ml.corner={tl:{x:a.ml.x,y:a.ml.y},tr:{x:a.ml.x+h,y:a.ml.y+o},bl:{x:a.ml.x-o,y:a.ml.y+h}};a.ml.corner.br={x:a.ml.corner.tr.x-o,y:a.ml.corner.tr.y+h};a.ml.x+=c;a.ml.y+=c;a.mt.x-=c;a.mt.y-=c;a.mt.corner={tl:{x:a.mt.x,y:a.mt.y},tr:{x:a.mt.x+h,y:a.mt.y+
o},bl:{x:a.mt.x-o,y:a.mt.y+h}};a.mt.corner.br={x:a.mt.corner.tr.x-o,y:a.mt.corner.tr.y+h};a.mt.x+=c;a.mt.y+=c;a.mr.x-=c;a.mr.y-=c;a.mr.corner={tl:{x:a.mr.x,y:a.mr.y},tr:{x:a.mr.x+h,y:a.mr.y+o},bl:{x:a.mr.x-o,y:a.mr.y+h}};a.mr.corner.br={x:a.mr.corner.tr.x-o,y:a.mr.corner.tr.y+h};a.mr.x+=c;a.mr.y+=c;a.mb.x-=c;a.mb.y-=c;a.mb.corner={tl:{x:a.mb.x,y:a.mb.y},tr:{x:a.mb.x+h,y:a.mb.y+o},bl:{x:a.mb.x-o,y:a.mb.y+h}};a.mb.corner.br={x:a.mb.corner.tr.x-o,y:a.mb.corner.tr.y+h};a.mb.x+=c;a.mb.y+=c;a=a.mb.corner;
a.tl.x-=c;a.tl.y-=c;a.tr.x-=c;a.tr.y-=c;a.br.x-=c;a.br.y-=c;a.bl.x-=c;a.bl.y-=c},toGrayscale:function(){var a=this.get("fill");a&&this.set("overlayFill",(new k.Color(a)).toGrayscale().toRgb());return this},complexity:function(){return 0},getCenter:function(){return{x:this.get("left")+this.width/2,y:this.get("top")+this.height/2}},straighten:function(){this.setAngle(this._getAngleValueForStraighten());return this},fxStraighten:function(a){a=a||{};var c=function(){},h=a.onComplete||c,o=a.onChange||
c,q=this;k.util.animate({startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(r){q.setAngle(r);o()},onComplete:function(){q.setCoords();h()},onStart:function(){q.setActive(false)}});return this},fxRemove:function(a){a||(a={});var c=function(){},h=a.onComplete||c,o=a.onChange||c,q=this;k.util.animate({startValue:this.get("opacity"),endValue:0,duration:this.FX_DURATION,onChange:function(r){q.set("opacity",r);o()},onComplete:h,onStart:function(){q.setActive(false)}});
return this},_getAngleValueForStraighten:function(){var a=this.get("angle");if(a>-225&&a<=-135)return-180;else if(a>-135&&a<=-45)return-90;else if(a>-45&&a<=45)return 0;else if(a>45&&a<=135)return 90;else if(a>135&&a<=225)return 180;else if(a>225&&a<=315)return 270;else if(a>315)return 360;return 0},toJSON:function(){return this.toObject()}});k.Object.prototype.rotate=k.Object.prototype.setAngle}})();
(function(){var k=this.fabric||(this.fabric={}),p=k.util.object.extend;if(!k.Line){k.Line=k.util.createClass(k.Object,{type:"line",initialize:function(e,l){e||(e=[0,0,0,0]);this.callSuper("initialize",l);this.set("x1",e[0]);this.set("y1",e[1]);this.set("x2",e[2]);this.set("y2",e[3]);this.set("width",this.x2-this.x1);this.set("height",this.y2-this.y1);this.set("left",this.x1+this.width/2);this.set("top",this.y1+this.height/2)},_render:function(e){e.beginPath();e.moveTo(-this.width/2,-this.height/2);
e.lineTo(this.width/2,this.height/2);var l=e.strokeStyle;e.strokeStyle=e.fillStyle;e.stroke();e.strokeStyle=l},complexity:function(){return 1},toObject:function(){return p(this.callSuper("toObject"),{x1:this.get("x1"),y1:this.get("y1"),x2:this.get("x2"),y2:this.get("y2")})}});k.Element.ATTRIBUTE_NAMES="x1 y1 x2 y2 stroke stroke-width transform".split(" ");k.Line.fromElement=function(e,l){var g=k.parseAttributes(e,k.Element.ATTRIBUTE_NAMES);return new k.Line([g.x1||0,g.y1||0,g.x2||0,g.y2||0],p(g,l))};
k.Line.fromObject=function(e){return new k.Line([e.x1,e.y1,e.x2,e.y2],e)}}})();
(function(){var k=this.fabric||(this.fabric={}),p=Math.PI*2,e=k.util.object.extend;if(k.Circle)console.warn("fabric.Circle is already defined.");else{k.Circle=k.util.createClass(k.Object,{type:"circle",initialize:function(l){l=l||{};this.set("radius",l.radius||0);this.callSuper("initialize",l);l=this.get("radius")*2*this.get("scaleX");this.set("width",l).set("height",l)},toObject:function(){return e(this.callSuper("toObject"),{radius:this.get("radius")})},_render:function(l,g){l.beginPath();l.arc(g?
this.left:0,g?this.top:0,this.radius,0,p,false);l.closePath();this.fill&&l.fill();this.stroke&&l.stroke()},complexity:function(){return 1}});k.Circle.ATTRIBUTE_NAMES="cx cy r fill fill-opacity stroke stroke-width transform".split(" ");k.Circle.fromElement=function(l,g){g||(g={});var d=k.parseAttributes(l,k.Circle.ATTRIBUTE_NAMES);if(!("radius"in d&&d.radius>0))throw Error("value of `r` attribute is required and can not be negative");if("left"in d)d.left-=g.width/2||0;if("top"in d)d.top-=g.height/
2||0;return new k.Circle(e(d,g))};k.Circle.fromObject=function(l){return new k.Circle(l)}}})();
(function(){var k=this.fabric||(this.fabric={});if(!k.Triangle){k.Triangle=k.util.createClass(k.Object,{type:"triangle",initialize:function(p){p=p||{};this.callSuper("initialize",p);this.set("width",p.width||100).set("height",p.height||100)},_render:function(p){var e=this.width/2,l=this.height/2;p.beginPath();p.moveTo(-e,l);p.lineTo(0,-l);p.lineTo(e,l);p.closePath();this.fill&&p.fill();this.stroke&&p.stroke()},complexity:function(){return 1}});k.Triangle.fromObject=function(p){return new k.Triangle(p)}}})();
(function(){var k=this.fabric||(this.fabric={}),p=Math.PI*2,e=k.util.object.extend;if(k.Ellipse)console.warn("fabric.Ellipse is already defined.");else{k.Ellipse=k.util.createClass(k.Object,{type:"ellipse",initialize:function(l){l=l||{};this.callSuper("initialize",l);this.set("rx",l.rx||0);this.set("ry",l.ry||0);this.set("width",this.get("rx")*2);this.set("height",this.get("ry")*2)},toObject:function(){return e(this.callSuper("toObject"),{rx:this.get("rx"),ry:this.get("ry")})},render:function(l,g){if(!(this.rx===
0||this.ry===0))return this.callSuper("render",l,g)},_render:function(l,g){l.beginPath();l.save();l.transform(1,0,0,this.ry/this.rx,0,0);l.arc(g?this.left:0,g?this.top:0,this.rx,0,p,false);l.restore();this.stroke&&l.stroke();this.fill&&l.fill()},complexity:function(){return 1}});k.Ellipse.ATTRIBUTE_NAMES="cx cy rx ry fill fill-opacity stroke stroke-width transform".split(" ");k.Ellipse.fromElement=function(l,g){g||(g={});var d=k.parseAttributes(l,k.Ellipse.ATTRIBUTE_NAMES);if("left"in d)d.left-=g.width/
2||0;if("top"in d)d.top-=g.height/2||0;return new k.Ellipse(e(d,g))};k.Ellipse.fromObject=function(l){return new k.Ellipse(l)}}})();
(function(){var k=this.fabric||(this.fabric={});if(!k.Rect){k.Rect=k.util.createClass(k.Object,{type:"rect",options:{rx:0,ry:0},initialize:function(p){this.callSuper("initialize",p);this._initRxRy()},_initRxRy:function(){if(this.options.rx&&!this.options.ry)this.options.ry=this.options.rx;else if(this.options.ry&&!this.options.rx)this.options.rx=this.options.ry},_render:function(p){var e=this.options.rx||0,l=this.options.ry||0,g=-this.width/2,d=-this.height/2,b=this.width,a=this.height;p.beginPath();
p.moveTo(g+e,d);p.lineTo(g+b-e,d);p.bezierCurveTo(g+b,d,g+b,d+l,g+b,d+l);p.lineTo(g+b,d+a-l);p.bezierCurveTo(g+b,d+a,g+b-e,d+a,g+b-e,d+a);p.lineTo(g+e,d+a);p.bezierCurveTo(g,d+a,g,d+a-l,g,d+a-l);p.lineTo(g,d+l);p.bezierCurveTo(g,d,g+e,d,g+e,d);p.closePath();this.fill&&p.fill();this.stroke&&p.stroke()},_normalizeLeftTopProperties:function(p){p.left&&this.set("left",p.left+this.getWidth()/2);p.top&&this.set("top",p.top+this.getHeight()/2);return this},complexity:function(){return 1}});k.Rect.ATTRIBUTE_NAMES=
"x y width height rx ry fill fill-opacity stroke stroke-width transform".split(" ");k.Rect.fromElement=function(p,e){if(!p)return null;var l=k.parseAttributes(p,k.Rect.ATTRIBUTE_NAMES);l=l;l.left=l.left||0;l.top=l.top||0;l=l;var g=new k.Rect(k.util.object.extend(e||{},l));g._normalizeLeftTopProperties(l);return g};k.Rect.fromObject=function(p){return new k.Rect(p)}}})();
(function(){var k=this.fabric||(this.fabric={});if(k.Polyline)console.warn("fabric.Polyline is already defined");else{k.Polyline=k.util.createClass(k.Object,{type:"polyline",initialize:function(e,l){l=l||{};this.set("points",e);this.callSuper("initialize",l);this._calcDimensions()},_calcDimensions:function(){return k.Polygon.prototype._calcDimensions.call(this)},toObject:function(){return k.Polygon.prototype.toObject.call(this)},_render:function(e){var l;e.beginPath();for(var g=0,d=this.points.length;g<
d;g++){l=this.points[g];e.lineTo(l.x,l.y)}this.fill&&e.fill();this.stroke&&e.stroke()},complexity:function(){return this.get("points").length}});var p="fill fill-opacity stroke stroke-width transform".split(" ");k.Polyline.fromElement=function(e,l){if(!e)return null;l||(l={});for(var g=k.parsePointsAttribute(e.getAttribute("points")),d=k.parseAttributes(e,p),b=0,a=g.length;b<a;b++){g[b].x-=l.width/2||0;g[b].y-=l.height/2||0}return new k.Polyline(g,k.util.object.extend(d,l))};k.Polyline.fromObject=
function(e){return new k.Polyline(e.points,e)}}})();
(function(){var k=this.fabric||(this.fabric={}),p=k.util.object.extend,e=k.util.array.min,l=k.util.array.max;if(k.Polygon)console.warn("fabric.Polygon is already defined");else{k.Polygon=k.util.createClass(k.Object,{type:"polygon",initialize:function(g,d){d=d||{};this.points=g;this.callSuper("initialize",d);this._calcDimensions()},_calcDimensions:function(){var g=this.points,d=e(g,"x"),b=e(g,"y"),a=l(g,"x");g=l(g,"y");this.width=a-d;this.height=g-b;this.minX=d;this.minY=b},toObject:function(){return p(this.callSuper("toObject"),
{points:this.points.concat()})},_render:function(g){var d;g.beginPath();for(var b=0,a=this.points.length;b<a;b++){d=this.points[b];g.lineTo(d.x,d.y)}this.fill&&g.fill();if(this.stroke){g.closePath();g.stroke()}},complexity:function(){return this.points.length}});k.Polygon.ATTRIBUTE_NAMES="fill fill-opacity stroke stroke-width transform".split(" ");k.Polygon.fromElement=function(g,d){if(!g)return null;d||(d={});for(var b=k.parsePointsAttribute(g.getAttribute("points")),a=k.parseAttributes(g,k.Polygon.ATTRIBUTE_NAMES),
c=0,h=b.length;c<h;c++){b[c].x-=d.width/2||0;b[c].y-=d.height/2||0}return new k.Polygon(b,p(a,d))};k.Polygon.fromObject=function(g){return new k.Polygon(g.points,g)}}})();
(function(){var k=this.fabric||(this.fabric={}),p=k.util.array.min,e=k.util.array.max,l=k.util.object.extend;if(k.Path)console.warn("fabric.Path is already defined");else if(k.Object){k.Path=k.util.createClass(k.Object,{type:"path",initialize:function(d,b){b=b||{};this.setOptions(b);this._importProperties();this.originalState={};if(!d)throw Error("`path` argument is required");var a=Object.prototype.toString.call(d)==="[object Array]";if(this.path=a?d:d.match&&d.match(/[a-zA-Z][^a-zA-Z]*/g)){a||this._initializeFromArray(b);
this.setCoords();b.sourcePath&&this.setSourcePath(b.sourcePath)}},_initializeFromArray:function(d){var b="width"in d;d="height"in d;this.path=this._parsePath();if(!b||!d){l(this,this._parseDimensions());if(b)this.width=this.options.width;if(d)this.height=this.options.height}},_render:function(d){for(var b,a=0,c=0,h=0,o=0,q,r,u=-(this.width/2),x=-(this.height/2),t=0,v=this.path.length;t<v;++t){b=this.path[t];switch(b[0]){case "l":a+=b[1];c+=b[2];d.lineTo(a+u,c+x);break;case "L":a=b[1];c=b[2];d.lineTo(a+
u,c+x);break;case "h":a+=b[1];d.lineTo(a+u,c+x);break;case "H":a=b[1];d.lineTo(a+u,c+x);break;case "v":c+=b[1];d.lineTo(a+u,c+x);break;case "V":c=b[1];d.lineTo(a+u,c+x);break;case "m":a+=b[1];c+=b[2];d.moveTo(a+u,c+x);break;case "M":a=b[1];c=b[2];d.moveTo(a+u,c+x);break;case "c":q=a+b[5];r=c+b[6];h=a+b[3];o=c+b[4];d.bezierCurveTo(a+b[1]+u,c+b[2]+x,h+u,o+x,q+u,r+x);a=q;c=r;break;case "C":a=b[5];c=b[6];h=b[3];o=b[4];d.bezierCurveTo(b[1]+u,b[2]+x,h+u,o+x,a+u,c+x);break;case "s":q=a+b[3];r=c+b[4];h=2*
a-h;o=2*c-o;d.bezierCurveTo(h+u,o+x,a+b[1]+u,c+b[2]+x,q+u,r+x);a=q;c=r;break;case "S":q=b[3];r=b[4];h=2*a-h;o=2*c-o;d.bezierCurveTo(h+u,o+x,b[1]+u,b[2]+x,q+u,r+x);a=q;c=r;break;case "q":a+=b[3];c+=b[4];d.quadraticCurveTo(b[1]+u,b[2]+x,a+u,c+x);break;case "Q":a=b[3];c=b[4];h=b[1];o=b[2];d.quadraticCurveTo(h+u,o+x,a+u,c+x);break;case "T":q=a;r=c;a=b[1];c=b[2];h=-h+2*q;o=-o+2*r;d.quadraticCurveTo(h+u,o+x,a+u,c+x);break;case "a":break;case "A":break;case "z":case "Z":d.closePath();break}}},render:function(d,
b){d.save();var a=this.transformMatrix;a&&d.transform(a[0],a[1],a[2],a[3],a[4],a[5]);b||this.transform(d);if(this.overlayFill)d.fillStyle=this.overlayFill;else if(this.fill)d.fillStyle=this.fill;if(this.stroke)d.strokeStyle=this.stroke;d.beginPath();this._render(d);this.fill&&d.fill();if(this.stroke){d.strokeStyle=this.stroke;d.lineWidth=this.strokeWidth;d.lineCap=d.lineJoin="round";d.stroke()}if(!b&&this.active){this.drawBorders(d);this.hideCorners||this.drawCorners(d)}d.restore()},toString:function(){return"#<fabric.Path ("+
this.complexity()+"): "+JSON.stringify({top:this.top,left:this.left})+">"},toObject:function(){var d=l(this.callSuper("toObject"),{path:this.path});if(this.sourcePath)d.sourcePath=this.sourcePath;if(this.transformMatrix)d.transformMatrix=this.transformMatrix;return d},toDatalessObject:function(){var d=this.toObject();if(this.sourcePath)d.path=this.sourcePath;delete d.sourcePath;return d},complexity:function(){return this.path.length},set:function(d,b){return this.callSuper("set",d,b)},_parsePath:function(){for(var d=
[],b,a,c=0,h=this.path.length;c<h;c++){b=this.path[c];a=b.slice(1).trim().replace(/(\d)-/g,"$1###-").split(/\s|,|###/);d.push([b.charAt(0)].concat(a.map(parseFloat)))}return d},_parseDimensions:function(){function d(w){if(w[0]==="H")return w[1];return w[w.length-2]}function b(w){if(w[0]==="V")return w[1];return w[w.length-1]}var a=[],c=[],h,o,q=false,r,u;this.path.forEach(function(w,A){if(w[0]!=="H")h=A===0?d(w):d(this.path[A-1]);if(w[0]!=="V")o=A===0?b(w):b(this.path[A-1]);if(w[0]===w[0].toLowerCase())q=
true;r=q?h+d(w):w[0]==="V"?h:d(w);u=q?o+b(w):w[0]==="H"?o:b(w);var D=parseInt(r,10);isNaN(D)||a.push(D);D=parseInt(u,10);isNaN(D)||c.push(D)},this);var x=p(a),t=p(c),v=deltaY=0;x={top:t-deltaY,left:x-v,bottom:e(c)-deltaY,right:e(a)-v};x.width=x.right-x.left;x.height=x.bottom-x.top;return x}});k.Path.fromObject=function(d){return new k.Path(d.path,d)};var g=k.Path.ATTRIBUTE_NAMES="d fill fill-opacity fill-rule stroke stroke-width transform".split(" ");k.Path.fromElement=function(d,b){var a=k.parseAttributes(d,
g),c=a.d;delete a.d;return new k.Path(c,l(a,b))}}else console.warn("fabric.Path requires fabric.Object")})();
(function(){var k=this.fabric||(this.fabric={}),p=k.util.object.extend,e=k.util.array.invoke,l=k.Object.prototype.set,g=k.Object.prototype.toObject,d=k.util.string.camelize,b=k.util.string.capitalize;if(k.PathGroup)console.warn("fabric.PathGroup is already defined");else{k.PathGroup=k.util.createClass(k.Path,{type:"path-group",forceFillOverwrite:false,initialize:function(a,c){c=c||{};this.originalState={};this.paths=a;this.setOptions(c);this.initProperties();this.setCoords();c.sourcePath&&this.setSourcePath(c.sourcePath)},
initProperties:function(){this.stateProperties.forEach(function(a){if(a==="fill")this.set(a,this.options[a]);else if(a==="angle")this.setAngle(this.options[a]);else this[a]=this.options[a]},this)},render:function(a){if(this.stub){a.save();this.transform(a);this.stub.render(a,false);if(this.active){this.drawBorders(a);this.drawCorners(a)}}else{a.save();var c=this.transformMatrix;c&&a.transform(c[0],c[1],c[2],c[3],c[4],c[5]);this.transform(a);c=0;for(var h=this.paths.length;c<h;++c)this.paths[c].render(a,
true);if(this.active){this.drawBorders(a);this.hideCorners||this.drawCorners(a)}}a.restore()},set:function(a,c){if((a==="fill"||a==="overlayFill")&&this.isSameColor()){this[a]=c;for(var h=this.paths.length;h--;)this.paths[h].set(a,c)}else l.call(this,a,c);return this},toObject:function(){return p(g.call(this),{paths:e(this.getObjects(),"clone"),sourcePath:this.sourcePath})},toDatalessObject:function(){var a=this.toObject();if(this.sourcePath)a.paths=this.sourcePath;return a},toString:function(){return"#<fabric.PathGroup ("+
this.complexity()+"): { top: "+this.top+", left: "+this.left+" }>"},isSameColor:function(){var a=this.getObjects()[0].get("fill");return this.getObjects().every(function(c){return c.get("fill")===a})},complexity:function(){return this.paths.reduce(function(a,c){return a+(c&&c.complexity?c.complexity():0)},0)},toGrayscale:function(){for(var a=this.paths.length;a--;)this.paths[a].toGrayscale();return this},getObjects:function(){return this.paths}});k.PathGroup.fromObject=function(a){for(var c=a.paths,
h=0,o=c.length;h<o;h++)if(!(c[h]instanceof k.Object)){var q=d(b(c[h].type));c[h]=k[q].fromObject(c[h])}return new k.PathGroup(c,a)}}})();
(function(){var k=this.fabric||(this.fabric={}),p=k.util.object.extend,e=k.util.array.min,l=k.util.array.max,g=k.util.array.invoke,d=k.util.removeFromArray;if(!k.Group){k.Group=k.util.createClass(k.Object,{type:"group",initialize:function(b,a){this.objects=b||[];this.originalState={};this.callSuper("initialize");this._calcBounds();this._updateObjectsCoords();a&&p(this,a);this._setOpacityIfSame();this.setCoords(true);this.saveCoords();this.activateAllObjects()},_updateObjectsCoords:function(){var b=
this.left,a=this.top;this.forEachObject(function(c){var h=c.get("left"),o=c.get("top");c.set("originalLeft",h);c.set("originalTop",o);c.set("left",h-b);c.set("top",o-a);c.setCoords();c.hideCorners=true},this)},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},getObjects:function(){return this.objects},add:function(b){this._restoreObjectsState();this.objects.push(b);b.setActive(true);this._calcBounds();this._updateObjectsCoords();return this},remove:function(b){this._restoreObjectsState();
d(this.objects,b);b.setActive(false);this._calcBounds();this._updateObjectsCoords();return this},size:function(){return this.getObjects().length},set:function(b,a){if(typeof a=="function")this.set(b,a(this[b]));else if(b==="fill"||b==="opacity"){var c=this.objects.length;for(this[b]=a;c--;)this.objects[c].set(b,a)}else this[b]=a;return this},contains:function(b){return this.objects.indexOf(b)>-1},toObject:function(){return p(this.callSuper("toObject"),{objects:g(this.objects,"clone")})},render:function(b){b.save();
this.transform(b);for(var a=Math.max(this.scaleX,this.scaleY),c=0,h;h=this.objects[c];c++){var o=h.borderScaleFactor;h.borderScaleFactor=a;h.render(b);h.borderScaleFactor=o}this.hideBorders||this.drawBorders(b);this.hideCorners||this.drawCorners(b);b.restore();this.setCoords()},item:function(b){return this.getObjects()[b]},complexity:function(){return this.getObjects().reduce(function(b,a){b+=typeof a.complexity=="function"?a.complexity():0;return b},0)},_restoreObjectsState:function(){this.objects.forEach(this._restoreObjectState,
this);return this},_restoreObjectState:function(b){var a=this.get("left"),c=this.get("top"),h=this.getAngle()*(Math.PI/180);b.get("originalLeft");b.get("originalTop");var o=Math.cos(h)*b.get("top")+Math.sin(h)*b.get("left");h=-Math.sin(h)*b.get("top")+Math.cos(h)*b.get("left");b.setAngle(b.getAngle()+this.getAngle());b.set("left",a+h*this.get("scaleX"));b.set("top",c+o*this.get("scaleY"));b.set("scaleX",b.get("scaleX")*this.get("scaleX"));b.set("scaleY",b.get("scaleY")*this.get("scaleY"));b.setCoords();
b.hideCorners=false;b.setActive(false);b.setCoords();return this},destroy:function(){return this._restoreObjectsState()},saveCoords:function(){this._originalLeft=this.get("left");this._originalTop=this.get("top");return this},hasMoved:function(){return this._originalLeft!==this.get("left")||this._originalTop!==this.get("top")},setObjectsCoords:function(){this.forEachObject(function(b){b.setCoords()});return this},activateAllObjects:function(){return this.setActive(true)},setActive:function(b){this.forEachObject(function(a){a.setActive(b)});
return this},forEachObject:function(b,a){for(var c=this.getObjects(),h=c.length;h--;)b.call(a,c[h],h,c);return this},_setOpacityIfSame:function(){var b=this.getObjects(),a=b[0]?b[0].get("opacity"):1;if(b.every(function(c){return c.get("opacity")===a}))this.opacity=a},_calcBounds:function(){var b=[],a=[],c,h;h=0;for(var o=this.objects.length;h<o;++h){c=this.objects[h];c.setCoords();for(var q in c.oCoords){b.push(c.oCoords[q].x);a.push(c.oCoords[q].y)}}c=e(b);h=l(b);b=e(a);a=l(a);h=h-c;a=a-b;this.width=
h;this.height=a;this.left=c+h/2;this.top=b+a/2},containsPoint:function(b){var a=this.get("width")/2,c=this.get("height")/2,h=this.get("left"),o=this.get("top");return h-a<b.x&&h+a>b.x&&o-c<b.y&&o+c>b.y},toGrayscale:function(){for(var b=this.objects.length;b--;)this.objects[b].toGrayscale()}});k.Group.fromObject=function(b){return new k.Group(b.objects,b)}}})();
(function(){var k=this.fabric||(this.fabric={}),p=k.util.object.extend,e=k.util.object.clone;if(k.Text)console.warn("fabric.Text is already defined");else if(k.Object){k.Text=k.util.createClass(k.Object,{options:{top:10,left:10,fontsize:20,fontweight:100,fontfamily:"Modernist_One_400",path:null},type:"text",initialize:function(l,g){this.originalState={};this.initStateProperties();this.text=l;this.setOptions(g);p(this,this.options);this.theta=this.angle*(Math.PI/180);this.width=this.getWidth();this.setCoords()},
initStateProperties:function(){var l;if((l=this.constructor)&&(l=l.superclass)&&(l=l.prototype)&&(l=l.stateProperties)&&l.clone){this.stateProperties=l.clone();this.stateProperties.push("fontfamily","fontweight","path")}},toString:function(){return"#<fabric.Text ("+this.complexity()+"): "+JSON.stringify({text:this.text,fontfamily:this.fontfamily})+">"},_render:function(l){var g=Cufon.textOptions||(Cufon.textOptions={});g.left=this.left;g.top=this.top;g.context=l;g.color=this.fill;var d=this._initDummyElement();
this.transform(l);Cufon.replaceElement(d,{separate:"none",fontFamily:this.fontfamily});this.width=g.width;this.height=g.height},_initDummyElement:function(){var l=document.createElement("div");l.innerHTML=this.text;l.style.fontSize="40px";l.style.fontWeight="400";l.style.fontStyle="normal";l.style.letterSpacing="normal";l.style.color="#000000";l.style.fontWeight="600";l.style.fontFamily="Verdana";return l},render:function(l){l.save();this._render(l);if(this.active){this.drawBorders(l);this.drawCorners(l)}l.restore()},
toObject:function(){return p(this.callSuper("toObject"),{text:this.text,fontsize:this.fontsize,fontweight:this.fontweight,fontfamily:this.fontfamily,path:this.path})},setColor:function(l){this.set("fill",l);return this},setFontsize:function(l){this.set("fontsize",l);this.setCoords();return this},getText:function(){return this.text},setText:function(l){this.set("text",l);this.setCoords();return this},set:function(l,g){this[l]=g;if(l==="fontfamily")this.path=this.path.replace(/(.*?)([^\/]*)(\.font\.js)/,
"$1"+g+"$3");return this}});k.Text.fromObject=function(l){return new k.Text(l.text,e(l))};k.Text.fromElement=function(){}}else console.warn("fabric.Text requires fabric.Object")})();
(function(){var k=fabric.util.object.extend;if(!this.fabric)this.fabric={};if(this.fabric.Image)console.warn("fabric.Image is already defined.");else if(fabric.Object){fabric.Image=fabric.util.createClass(fabric.Object,{maxwidth:null,maxheight:null,active:false,bordervisibility:false,cornervisibility:false,type:"image",__isGrayscaled:false,initialize:function(p,e){this.callSuper("initialize",e);this._initElement(p);this._initConfig(e||{})},getElement:function(){return this._element},setElement:function(p){this._element=
p;return this},getNormalizedSize:function(p,e,l){if(l&&e&&p.width>p.height&&p.width/p.height<e/l){normalizedWidth=~~(p.width*l/p.height);normalizedHeight=l}else if(l&&(p.height==p.width||p.height>p.width||p.height>l)){normalizedWidth=~~(p.width*l/p.height);normalizedHeight=l}else if(e&&e<p.width){normalizedHeight=~~(p.height*e/p.width);normalizedWidth=e}else{normalizedWidth=p.width;normalizedHeight=p.height}return{width:normalizedWidth,height:normalizedHeight}},getOriginalSize:function(){var p=this.getElement();
return{width:p.width,height:p.height}},setBorderVisibility:function(p){this._resetWidthHeight();this._adjustWidthHeightToBorders(p);this.setCoords()},setCornersVisibility:function(p){this.cornervisibility=!!p},render:function(p,e){p.save();e||this.transform(p);this._render(p);if(this.active&&!e){this.drawBorders(p);this.hideCorners||this.drawCorners(p)}p.restore()},toObject:function(){return k(this.callSuper("toObject"),{src:this.getSrc()})},getSrc:function(){return this.getElement().src},toString:function(){return'#<fabric.Image: { src: "'+
this.getSrc()+'" }>'},clone:function(p){this.constructor.fromObject(this.toObject(),p)},toGrayscale:function(p){if(!this.__isGrayscaled){var e=this.getElement(),l=document.createElement("canvas"),g=document.createElement("img"),d=this;l.width=e.width;l.height=e.height;l.getContext("2d").drawImage(e,0,0);fabric.Element.toGrayscale(l);g.onload=function(){d.setElement(g);p&&p();g.onload=l=e=imageData=null};g.width=e.width;g.height=e.height;g.src=l.toDataURL("image/png");this.__isGrayscaled=true;return this}},
_render:function(p){var e=this.getOriginalSize();p.drawImage(this.getElement(),-e.width/2,-e.height/2,e.width,e.height)},_adjustWidthHeightToBorders:function(p){if(p){this.currentBorder=this.borderwidth;this.width+=2*this.currentBorder;this.height+=2*this.currentBorder}else this.currentBorder=0},_resetWidthHeight:function(){var p=this.getElement();this.set("width",p.width);this.set("height",p.height)},_initElement:function(p){this.setElement(fabric.util.getById(p));fabric.util.addClass(this.getElement(),
fabric.Image.CSS_CANVAS)},_initConfig:function(p){this.setOptions(p);this._setBorder();this._setWidthHeight(p)},_setBorder:function(){this.currentBorder=this.bordervisibility?this.borderwidth:0},_setWidthHeight:function(){var p=2*this.currentBorder;this.width=(this.getElement().width||0)+p;this.height=(this.getElement().height||0)+p},complexity:function(){return 1}});fabric.Image.CSS_CANVAS="canvas-img";fabric.Image.fromObject=function(p,e){var l=document.createElement("img"),g=p.src;if(p.width)l.width=
p.width;if(p.height)l.height=p.height;l.onload=function(){e&&e(new fabric.Image(l,p));l=l.onload=null};l.src=g};fabric.Image.fromURL=function(p,e,l){var g=document.createElement("img");g.onload=function(){e&&e(new fabric.Image(g,l));g=g.onload=null};g.src=p}}else console.warn("fabric.Object is required for fabric.Image initialization")})();
